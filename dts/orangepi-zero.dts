#include <sun8i-h2-plus-orangepi-zero.dts>

/ {
    aliases {
        serial1 = &uart1;
    };

    beeper {
        pwm-names = "opinicus-board-beeper";
        compatible = "pwm-beeper";
        pwms = <&pwm 0 500000 0>;
        status = "okay";
    };

    rotary {
        pinctrl-names = "default";
        pinctrl-0 = <&rotary_pins_opinicus>;
        compatible = "rotary-encoder";
        gpios = <&pio 0 0 GPIO_ACTIVE_LOW>, <&pio 0 1 GPIO_ACTIVE_LOW>;
        linux,axis = <8>;
        rotary-encoder,relative-axis;
        rotary-encoder,steps-per-period = <4>;
        status = "okay";
    };

    gpio_keys {
        compatible = "gpio-keys";
        input-name = "k1";
        pinctrl-names = "default";
        pinctrl-0 = <&rotary_push>;

        k1@0 {
            label = "k1";
            linux,code = <KEY_ENTER>;
            gpios = <&pio 0 3 GPIO_ACTIVE_LOW>;
        };
    };
};

&uart1 {
    pinctrl-names = "default";
    pinctrl-0 = <&uart1_pins>;
    status = "okay";
};

&ehci2 {
    status = "okay";
};

&ohci2 {
    status = "okay";
};

&ehci3 {
    status = "okay";
};

&ohci3 {
    status = "okay";
};

&i2c0 {
    status = "okay";
    ssd1309: oled@3c {
        compatible = "solomon,ssd1309fb-i2c";
        pinctrl-names = "default";
        pinctrl-0 = <&oled_pins_opinicus>;
        reset-gpios = <&pio 0 7 GPIO_ACTIVE_HIGH>;
        reg = <0x3c>;
        solomon,width = <128>;
        solomon,height = <64>;
        solomon,com-invdir;
        solomon,page-offset = <0>;
        solomon,prechargep1 = <2>;
        solomon,prechargep2 = <8>;
    };
/*
    ssd1306: oled@3c {
        compatible = "solomon,ssd1306fb-i2c";
        pinctrl-names = "default";
        pinctrl-0 = <&oled_pins_opinicus>;
        reset-gpios = <&pio 0 7 GPIO_ACTIVE_HIGH>;
        reg = <0x3c>;
        solomon,width = <128>;
        solomon,height = <32>;
        solomon,com-invdir;
        solomon,com-seq;
        solomon,page-offset = <0>;
        solomon,prechargep1 = <2>;
        solomon,prechargep2 = <8>;
    };
*/
};

&pio {
    oled_pins_opinicus: oled_pins@0 {
        pins = "PA7";
        function = "gpio_out";
        bias-pull-down;
    };

    rotary_pins_opinicus: rotary_pins@0 {
        pins = "PA0", "PA1";
        function = "gpio_in";
        bias-pull-up;
    };
    
    pwm1_pins_a: pwm1@0 {
        pins = "PA6";
        function = "pwm";
    };

    rotary_push: key_pins@0 {
        pins = "PA3";
        function = "gpio_in";
        bias-pull-up;
    };
};

&spi0 {
    status = "okay";
};

&spi1 {
    status = "okay";
    
    microsd@0 {
        compatible = "mmc-spi-slot";
        spi-max-frequency = <100000>;
        voltage-ranges = <3200 3400>;
        broken-cd;
        reg = <0>;
    };
};

&pwm {
    pinctrl-names = "default";
    pinctrl-0 = <&pwm1_pins_a>;
    status = "okay";
};
